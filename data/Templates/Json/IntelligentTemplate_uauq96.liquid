{
    "resourceType": "Patient",
    "id": "{{ msg.patientId | to_json_string | generate_uuid }}",
    "text": {
        "status": "generated",
        "div": "<div xmlns=\"http://www.w3.org/1999/xhtml\">Intelligent Patient Template</div>"
    },
    "active": true,
    "identifier": [
        {
            "use": "usual",
            "type": {
                "coding": [{
                    "system": "http://terminology.hl7.org/CodeSystem/v2-0203",
                    "code": "MR",
                    "display": "Medical record number"
                }]
            },
            "system": "urn:oid:2.16.840.1.113883.4.1",
            "value": "{{ msg.patientId }}"
        }
    ],
    "name": [
        {
            "use": "official",
            "text": "{{ msg.name }}"
        }
    ],
    {% if msg.gender -%}
    "gender": {% assign g = msg.gender | downcase -%}
        {% case g -%}
            {% when 'm' -%}"male"
            {% when 'male' -%}"male"
            {% when 'man' -%}"male"
            {% when 'f' -%}"female"
            {% when 'female' -%}"female"
            {% when 'woman' -%}"female"
            {% when 'o' -%}"other"
            {% when 'other' -%}"other"
            {% when 'u' -%}"unknown"
            {% when 'unknown' -%}"unknown"
            {% when 'n/a' -%}"unknown"
            {% else -%}"unknown"
        {% endcase -%},
    {% endif -%}
    {% if msg.dateOfBirth -%}
    "birthDate": "{{ msg.dateOfBirth }}",
    {% endif -%}
    "address": [
        {
            "use": "home",
            "line": ["{{ msg.addresses[0].line1 }}", "{{ msg.addresses[1].line1 }}"],
            "city": "{{ msg.addresses[0].city }}",
            "country": "{{ msg.addresses[0].country }}"
        }
    ],
    "managingOrganization": {
        "reference": "Organization/intelligent-system",
        "display": "Intelligent Template System"
    }
}